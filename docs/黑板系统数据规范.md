# 黑板系统 (Blackboard) 数据规范 v1.0

JS 服务端的黑板系统是机器人的“短期记忆”和“感官中心”。以下是当前已实现的数据项映射表：

## 1. 机器人状态 (Robot State) - 全局作用域
| 键名 (Key) | 类型 | 说明 | 来源 |
| :--- | :--- | :--- | :--- |
| `energy` | Number (0-100) | 能量值，低于 20 会触发睡觉逻辑 | `ActiveServiceBT` 计算 |
| `boredom` | Number (0-100) | 无聊度，高无聊度会触发主动对话 | `ActiveServiceBT` 计算 |
| `penguinPosition` | Array [x,y,z] | 机器人在 3D 空间中的实时坐标 | Godot `state_sync` 同步 |
| `isOnFloor` | Boolean | 是否在地面上 | Godot `state_sync` 同步 |
| `lastCollision` | Object | 包含碰撞体名、坐标、法线、时间戳 | Godot `interaction:collision` 上报 |

## 2. 交互状态 (Interaction) - 全局作用域
| 键名 (Key) | 类型 | 说明 | 来源 |
| :--- | :--- | :--- | :--- |
| `isDragging` | Boolean | 当前是否正在被鼠标拖拽 | Godot `drag_start/end` |
| `isClicked` | Boolean | 当前是否被单击（瞬时状态） | Godot `click` |
| `lastUserInput` | String | 用户最后输入的文本指令 | Godot `user_input` |
| `hasNewInput` | Boolean | 是否有未处理的新文本指令 | `BTServer` 接收逻辑 |

## 3. 决策输出 (Decision Outputs) - 树级/全局
| 键名 (Key) | 类型 | 说明 | 消费方 |
| :--- | :--- | :--- | :--- |
| `pendingActions` | Array<String> | 待执行的动作序列队列 | `ExecuteActionSequence` 节点 |
| `bt_output_action` | String | 当前 Tick 需要立即发送给客户端的动作名 | `BTServer` 推送逻辑 |
| `bt_output_chat_msgs` | Array<Object> | 待发送的回复消息（含协议和 UI 内容） | `BTServer` 推送逻辑 |
| `bt_output_position` | Array [x,y,z] | 服务端要求的移动目标位置 | `BTServer` 推送逻辑 |

## 4. 环境感知 (Sensing)
通过 `BlackboardGuard` 配合 `key` 函数，行为树可以感知更复杂的环境：
- **边界感知**：检测 `penguinPosition` 是否超出地图限制。
- **障碍感知**：通过 `lastCollision` 的时间戳判断机器人是否刚刚撞墙。
