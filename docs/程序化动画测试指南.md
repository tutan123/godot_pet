# 程序化动画测试指南

## 已实现的程序化动画列表

### 1. WAVE（挥手）👋
- **效果**：Z 轴左右摆动，配合轻微缩放
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`wave` 或 `WAVE`
  - 自然语言：`挥手`、`摆摆手`
- **视觉效果**：机器人左右摆动，像在挥手打招呼

### 2. SPIN（旋转）🌀
- **效果**：Y 轴持续旋转
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`spin` 或 `SPIN`
  - 自然语言：`转圈`、`旋转`
- **视觉效果**：机器人持续转圈（你已经看到了）

### 3. BOUNCE（弹跳）⚡
- **效果**：Y 轴上下弹跳，高度约 0.5 单位
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`bounce` 或 `BOUNCE`
  - 自然语言：`弹跳`、`跳一跳`
- **视觉效果**：机器人上下弹跳，有压缩感

### 4. FLY（飞行）✈️
- **效果**：Y 轴位置提升到 1.0 单位 + 轻微摆动 + 前倾
- **持续时间**：5秒（默认）
- **测试命令**：
  - Godot 输入框：`fly` 或 `FLY`
  - 自然语言：`飞起来`、`飞行`
- **视觉效果**：机器人上升并轻微摆动（你已经看到了）

### 5. ROLL（翻滚）🔄
- **效果**：Z 轴持续旋转（横滚）
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`roll` 或 `ROLL`
  - 自然语言：`翻滚`、`打滚`
- **视觉效果**：机器人横着旋转，像在翻滚

### 6. SHAKE（摇晃/颤抖）💫
- **效果**：快速左右抖动（X 轴位置） + 轻微旋转（Z 轴）
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`shake` 或 `SHAKE`
  - 自然语言：`摇晃`、`颤抖`、`发抖`
  - 别名：`shiver` 或 `SHIVER` 也会映射到 shake
- **视觉效果**：机器人快速左右抖动，像在颤抖

### 7. FLIP（后空翻）🤸
- **效果**：X 轴翻转 + 弹跳（高度约 0.8 单位）
- **持续时间**：2秒（默认）
- **测试命令**：
  - Godot 输入框：`flip` 或 `FLIP`
  - 自然语言：`后空翻`、`翻转`
  - 别名：`backflip` 或 `BACKFLIP` 也会映射到 flip
- **视觉效果**：机器人向后翻转同时弹跳

## 快速测试步骤

### 方法 1：直接在 Godot 客户端测试

1. 运行 Godot 客户端
2. 确保已连接到 WebSocket 服务器（`ws://localhost:8080`）
3. 在右下角输入框输入动作名称（不区分大小写）：
   ```
   wave
   bounce
   roll
   shake
   flip
   ```
4. 按 Enter 或点击 Send 按钮

### 方法 2：通过 RobotApp Web 界面测试

1. 运行 `npm run robot`
2. 在 RobotApp 的输入框输入自然语言：
   ```
   挥手
   弹跳
   转圈
   翻滚
   后空翻
   摇晃
   飞行
   ```
3. LLM 会解析并转换为对应的动作

### 方法 3：组合测试

可以发送多个动作，它们会按顺序执行：
```
跳舞 然后 挥手
先转圈 再弹跳
```

## 动画效果说明

### 程序化动画的特点

1. **实时计算**：每帧实时计算位置和旋转，不依赖骨骼动画
2. **叠加效果**：可以与基础姿态（idle）叠加
3. **平滑过渡**：使用 `lerp` 实现平滑的动画过渡
4. **自动清除**：动作持续时间结束后自动清除

### 技术细节

- **Wave**：`sin(proc_time * 15.0) * 0.15` - 15Hz 的摆动频率
- **Spin**：`proc_rot_y += delta * 20.0` - 每秒 20 弧度旋转
- **Bounce**：`abs(sin(proc_time * 10.0)) * 0.5` - 10Hz 的弹跳，高度 0.5
- **Fly**：`1.0 + sin(proc_time * 3.0) * 0.2` - 基础高度 1.0，3Hz 摆动
- **Roll**：`target_rot_z += delta * 15.0` - Z 轴每秒 15 弧度旋转
- **Shake**：`sin(proc_time * 25.0) * 0.1` - 25Hz 快速抖动
- **Flip**：`target_rot_x += delta * 15.0` - X 轴每秒 15 弧度旋转

## 测试建议

### 单个动作测试
依次测试每个动作，观察效果是否符合预期：
1. `wave` - 检查摆动幅度和频率
2. `bounce` - 检查弹跳高度和节奏
3. `roll` - 检查旋转方向和速度
4. `shake` - 检查抖动强度和频率
5. `flip` - 检查翻转角度和弹跳高度

### 组合测试
测试动作序列：
- `wave` → `bounce` - 检查过渡是否平滑
- `spin` → `fly` - 检查是否能正确切换
- `roll` → `shake` - 检查清理和初始化

### 边界测试
- 快速连续发送多个动作 - 检查优先级和中断逻辑
- 在动作执行中途发送新动作 - 检查是否能正确中断

## 已知问题

- 某些动作可能需要在 idle 状态才能看到最佳效果
- 动作持续时间由服务端控制，可以通过 `ACTION_DURATIONS` 常量调整

## 扩展动画建议

如果你想添加更多程序化动画，可以在 `_apply_procedural_fx` 函数中添加新的 `match` 分支：

```gdscript
match proc_anim_active:
    "new_anim":
        # 在这里实现新的动画效果
        target_pos_y = ...
        target_rot_x = ...
```

然后在 `_switch_anim` 函数的 `proc_anims` 数组中添加动作名称。
