# ç¯å¢ƒæ„ŸçŸ¥ä¸ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°ä¸¤ä¸ªç›¸å…³ä½†ä¸åŒçš„AIç¯å¢ƒå¤„ç†ç³»ç»Ÿï¼š

1. **ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨å¢å¼ºç³»ç»Ÿ**ï¼ˆæŒ‰éœ€è®¡ç®—æ™ºèƒ½ä¼ æ„Ÿå™¨ï¼‰
2. **ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿ EQS**ï¼ˆä½ç½®è¯„ä¼°å’Œå†³ç­–ï¼‰

å¹¶è¯´æ˜å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€åŒºåˆ«å’ŒååŒå·¥ä½œæœºåˆ¶ã€‚

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µå¯¹æ¯”

### ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨ vs ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿ

| ç»´åº¦ | ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨ | ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿ EQS |
|------|----------------|------------------|
| **æ ¸å¿ƒåŠŸèƒ½** | æ„ŸçŸ¥å½“å‰ç¯å¢ƒçŠ¶æ€ | è¯„ä¼°å’Œé€‰æ‹©æœ€ä½³ä½ç½® |
| **è§¦å‘æ–¹å¼** | æŒ‰éœ€è®¡ç®— | AIä¸»åŠ¨æŸ¥è¯¢ |
| **è¾“å‡ºç±»å‹** | å®æ—¶ä¼ æ„Ÿå™¨æ•°æ® | è¯„åˆ†æ’åºçš„ä½ç½®åˆ—è¡¨ |
| **æ€§èƒ½ç‰¹ç‚¹** | é›¶é—²ç½®å¼€é”€ | è®¡ç®—å¯†é›†å‹ |
| **ä½¿ç”¨åœºæ™¯** | çŠ¶æ€åŒæ­¥ã€æ¡ä»¶åˆ¤æ–­ | è·¯å¾„è§„åˆ’ã€æˆ˜æœ¯å†³ç­– |
| **å“åº”æ—¶é—´** | æ¯«ç§’çº§ | ç§’çº§ |

### é€šä¿—è§£é‡Š

**ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨** = **çœ¼ç›å’Œè€³æœµ**
- å®æ—¶å‘Šè¯‰ä½ "ç°åœ¨çœ‹åˆ°äº†ä»€ä¹ˆ"ã€"å¬åˆ°äº†ä»€ä¹ˆ"
- åªæœ‰éœ€è¦æ—¶æ‰ççœ¼/ç«–è€³å€¾å¬
- å¿«é€Ÿå“åº”å½“å‰çŠ¶æ€

**ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿ** = **æˆ˜ç•¥åˆ†æå¸ˆ**
- åŸºäºæ„ŸçŸ¥åˆ°çš„ä¿¡æ¯ï¼Œåˆ†æ"å“ªé‡Œæœ€å¥½å»"
- ä¸»åŠ¨æ€è€ƒå’Œè¯„ä¼°å„ç§é€‰é¡¹
- æä¾›å†³ç­–å»ºè®®

---

## ğŸ” ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨å¢å¼ºç³»ç»Ÿè¯¦è§£

### æ ¸å¿ƒç†å¿µï¼šAIéœ€è¦ä»€ä¹ˆï¼Œå°±è®¡ç®—ä»€ä¹ˆ

ä¼ ç»Ÿæ–¹å¼ï¼šæ¯å¸§éƒ½è®¡ç®—æ‰€æœ‰ä¼ æ„Ÿå™¨æ•°æ®
```
æ¯å¸§éƒ½è®¡ç®—ï¼šä¸»äººè·ç¦» + éšœç¢ç‰©æ£€æµ‹ + æ‰€æœ‰NPCä½ç½® + ...
ç»“æœï¼šCPUæŒç»­å ç”¨80%ï¼Œå¾ˆå¤šæ•°æ®ä»æœªä½¿ç”¨
```

æŒ‰éœ€è®¡ç®—æ–¹å¼ï¼šåªæœ‰å½“AIå†³ç­–éœ€è¦æ—¶æ‰è®¡ç®—
```
AIæƒ³"é è¿‘ä¸»äºº" â†’ è¯·æ±‚ä¸»äººè·ç¦»è®¡ç®— â†’ è·å¾—ç»“æœ â†’ åšå‡ºå†³ç­–
AIåœ¨å‘å‘† â†’ ä¸è®¡ç®—ä»»ä½•ä¼ æ„Ÿå™¨ â†’ é›¶å¼€é”€
```

### æ¶æ„è®¾è®¡

#### 1. æŒ‰éœ€ä¼ æ„Ÿå™¨è¯·æ±‚æ¥å£

```typescript
interface OnDemandSensorRequest {
  type: 'owner_proximity' | 'nearest_obstacle' | 'environment_scan' | 'path_obstacles';
  priority: 'low' | 'medium' | 'high';  // è®¡ç®—ä¼˜å…ˆçº§
  context?: {  // å¯é€‰ä¸Šä¸‹æ–‡ä¿¡æ¯
    range?: number;  // æ£€æµ‹èŒƒå›´
    direction?: [number, number, number];  // æ£€æµ‹æ–¹å‘
    complexity?: 'simple' | 'detailed';  // è®¡ç®—å¤æ‚åº¦
  };
}

interface SensorData {
  type: string;
  value: any;
  timestamp: number;
  computation_time: number;  // è®¡ç®—è€—æ—¶
  cache_valid_ms?: number;   // ç¼“å­˜æœ‰æ•ˆæœŸ
}
```

#### 2. æ™ºèƒ½ç¼“å­˜æœºåˆ¶

```typescript
class SensorCache {
  private cache: Map<string, CachedSensorData> = new Map();

  // æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
  isValid(sensorType: string): boolean {
    const cached = this.cache.get(sensorType);
    if (!cached) return false;

    const age = Date.now() - cached.timestamp;
    return age < cached.validDuration;
  }

  // è·å–ç¼“å­˜æ•°æ®
  get(sensorType: string): SensorData | null {
    return this.isValid(sensorType) ? this.cache.get(sensorType)?.data : null;
  }

  // æ›´æ–°ç¼“å­˜
  set(sensorType: string, data: SensorData, validDuration: number): void {
    this.cache.set(sensorType, {
      data,
      timestamp: Date.now(),
      validDuration
    });
  }
}
```

#### 3. ä¼˜å…ˆçº§è°ƒåº¦ç³»ç»Ÿ

```typescript
enum SensorPriority {
  HIGH = 'high',      // ç«‹å³è®¡ç®—ï¼ˆå¦‚å¯¼èˆªé¿éšœï¼‰
  MEDIUM = 'medium',  // æ­£å¸¸æ’é˜Ÿï¼ˆå¦‚ç¤¾äº¤è·ç¦»ï¼‰
  LOW = 'low'         // å»¶è¿Ÿè®¡ç®—ï¼ˆå¦‚èƒŒæ™¯æ‰«æï¼‰
}

class SensorScheduler {
  private highPriorityQueue: OnDemandSensorRequest[] = [];
  private mediumPriorityQueue: OnDemandSensorRequest[] = [];
  private lowPriorityQueue: OnDemandSensorRequest[] = [];

  // æ·»åŠ ä¼ æ„Ÿå™¨è¯·æ±‚
  addRequest(request: OnDemandSensorRequest): void {
    switch (request.priority) {
      case 'high':
        this.highPriorityQueue.push(request);
        break;
      case 'medium':
        this.mediumPriorityQueue.push(request);
        break;
      case 'low':
        this.lowPriorityQueue.push(request);
        break;
    }
  }

  // å¤„ç†ä¸‹ä¸€æ‰¹è¯·æ±‚
  processNextBatch(): void {
    // é«˜ä¼˜å…ˆçº§ç«‹å³å¤„ç†
    while (this.highPriorityQueue.length > 0) {
      const request = this.highPriorityQueue.shift()!;
      this.computeSensor(request);
    }

    // ä¸­ä¼˜å…ˆçº§å¤„ç†ä¸€ä¸ª
    if (this.mediumPriorityQueue.length > 0) {
      const request = this.mediumPriorityQueue.shift()!;
      this.computeSensor(request);
    }

    // ä½ä¼˜å…ˆçº§åœ¨ç©ºé—²æ—¶å¤„ç†
    if (this.lowPriorityQueue.length > 0 && this.isSystemIdle()) {
      const request = this.lowPriorityQueue.shift()!;
      this.computeSensor(request);
    }
  }
}
```

### å…·ä½“ä¼ æ„Ÿå™¨å®ç°

#### 1. ä¸»äººè·ç¦»ä¼ æ„Ÿå™¨ï¼ˆowner_proximityï¼‰

```gdscript
class_name OwnerProximitySensor
extends Node

func compute_proximity(context: Dictionary) -> float:
    var owner = get_node_or_null("/root/Main/Owner")
    if not owner:
        return 0.0

    var distance = global_position.distance_to(owner.global_position)
    var max_distance = context.get("range", 10.0)

    # è¿”å›0.0-1.0çš„æ¥è¿‘åº¦ï¼ˆ0.0=å¾ˆè¿œï¼Œ1.0=å¾ˆè¿‘ï¼‰
    return 1.0 - clamp(distance / max_distance, 0.0, 1.0)
```

#### 2. æœ€è¿‘éšœç¢ç‰©ä¼ æ„Ÿå™¨ï¼ˆnearest_obstacleï¼‰

```gdscript
func compute_nearest_obstacle(context: Dictionary) -> Dictionary:
    var range = context.get("range", 3.0)
    var complexity = context.get("complexity", "simple")

    if complexity == "simple":
        return _simple_obstacle_detection(range)
    else:
        return _detailed_obstacle_detection(range)

func _simple_obstacle_detection(range: float) -> Dictionary:
    var space_state = get_world_3d().direct_space_state
    var forward = -transform.basis.z

    var query = PhysicsRayQueryParameters3D.create(
        global_position + Vector3.UP * 0.5,
        global_position + forward * range + Vector3.UP * 0.5
    )
    query.collision_mask = 1  # åªæ£€æµ‹é™æ€å‡ ä½•ä½“

    var result = space_state.intersect_ray(query)

    if result:
        var distance = global_position.distance_to(result.position)
        var direction = (result.position - global_position).normalized()
        return {
            "distance": distance,
            "direction": [direction.x, direction.y, direction.z],
            "position": [result.position.x, result.position.y, result.position.z]
        }

    return {
        "distance": range,  # æœ€å¤§èŒƒå›´è¡¨ç¤ºæ— éšœç¢ç‰©
        "direction": [0, 0, 0],
        "position": null
    }
```

### å†³ç­–æ¨¡å¼é€‰æ‹©ï¼šè§„åˆ™ vs LLM

#### æ–¹æ¡ˆAï¼šå½“å‰è§„åˆ™ç³»ç»Ÿï¼ˆæ¨èï¼Œç¬¦åˆé©¬å°”å¯å¤«æ€§ï¼‰
```typescript
class LazySensorGuard extends Action {
  private sensorRequest: OnDemandSensorRequest;
  private condition: (data: SensorData) => boolean;
  private child: Action;

  tick(tick: Tick): number {
    // è§„åˆ™1ï¼šæ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
    const cachedData = sensorCache.get(this.sensorRequest.type);
    if (cachedData && this.isCacheValid(cachedData)) {
      // ç›´æ¥ä½¿ç”¨ç¼“å­˜æ•°æ®
      return this.evaluateCondition(cachedData) ? this.child.tick(tick) : FAILURE;
    }

    // è§„åˆ™2ï¼šè¯·æ±‚æ–°æ•°æ®
    this.requestSensorData(tick);
    return RUNNING;
  }
}
```

#### æ–¹æ¡ˆBï¼šLLMå†³ç­–ç³»ç»Ÿï¼ˆæœªæ¥æ‰©å±•ï¼‰
```typescript
class LLMSensorGuard extends Action {
  private sensorType: string;
  private decisionPrompt: string;
  private child: Action;

  tick(tick: Tick): number {
    // è·å–å½“å‰çŠ¶æ€ä¸Šä¸‹æ–‡ï¼ˆé©¬å°”å¯å¤«åŒ–ï¼‰
    const context = this.buildCurrentStateContext(tick);

    // LLMå†³ç­–ï¼šåŸºäºå½“å‰çŠ¶æ€å†³å®šæ˜¯å¦éœ€è¦ä¼ æ„Ÿå™¨
    const decision = await this.llm.decide({
      prompt: this.decisionPrompt,
      context: context,
      availableSensors: this.getAvailableSensors()
    });

    if (decision.needsSensor) {
      // è¯·æ±‚ä¼ æ„Ÿå™¨æ•°æ®
      this.requestSensorData(decision.requiredSensors);
      return RUNNING;
    }

    // LLMå†³ç­–ï¼šæ˜¯å¦æ‰§è¡Œå­è¡Œä¸º
    return decision.shouldExecute ? this.child.tick(tick) : FAILURE;
  }

  private buildCurrentStateContext(tick: Tick): StateContext {
    // åªåŒ…å«å½“å‰çŠ¶æ€ï¼Œä¸åŒ…å«å†å²
    return {
      currentBlackboard: tick.blackboard.getAllCurrentStates(),
      recentObservations: this.getRecentObservations(), // æœ€è¿‘çš„è§‚å¯Ÿç»“æœ
      activeActions: tick.blackboard.get('active_actions', treeId, nodeId),
      timestamp: Date.now()
    };
  }
}
```

### ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | è§„åˆ™ç³»ç»Ÿ | LLMå†³ç­–ç³»ç»Ÿ |
|------|----------|-------------|
| **é©¬å°”å¯å¤«æ€§** | âœ… å®Œå…¨ç¬¦åˆ | âš ï¸ éœ€è¦ç²¾å¿ƒè®¾è®¡ |
| **æ€§èƒ½** | âš¡ æé«˜ | ğŸŒ è¾ƒé«˜å»¶è¿Ÿ |
| **çµæ´»æ€§** | ğŸ”§ é…ç½®åŒ– | ğŸ§  è‡ªé€‚åº” |
| **å¯é¢„æµ‹æ€§** | ğŸ“Š ç¡®å®šæ€§ | ğŸ² æ¦‚ç‡æ€§ |
| **å¤æ‚åº¦** | ğŸŸ¢ ç®€å• | ğŸ”´ å¤æ‚ |

### ğŸ”„ æ··åˆæ–¹æ¡ˆï¼šè§„åˆ™ + LLM

```typescript
class HybridSensorGuard extends Action {
  private ruleBasedGuard: LazySensorGuard;
  private llmGuard: LLMSensorGuard;
  private complexityThreshold: number;

  tick(tick: Tick): number {
    // è§„åˆ™å†³ç­–ï¼šè¯„ä¼°å½“å‰åœºæ™¯å¤æ‚åº¦
    const complexity = this.assessSituationComplexity(tick);

    if (complexity < this.complexityThreshold) {
      // ç®€å•åœºæ™¯ï¼šç”¨è§„åˆ™ç³»ç»Ÿï¼ˆé«˜æ•ˆï¼‰
      return this.ruleBasedGuard.tick(tick);
    } else {
      // å¤æ‚åœºæ™¯ï¼šç”¨LLMç³»ç»Ÿï¼ˆæ™ºèƒ½ï¼‰
      return this.llmGuard.tick(tick);
    }
  }
}
```

---

## ğŸ” ç¯å¢ƒæŸ¥è¯¢ç³»ç»Ÿ EQS è¯¦è§£

### EQS æ ¸å¿ƒæ¦‚å¿µ

EQSï¼ˆEnvironment Query Systemï¼‰æ˜¯ä¸€ä¸ªç”¨äºåœ¨æ¸¸æˆç¯å¢ƒä¸­æ™ºèƒ½æŸ¥è¯¢å’Œè¯„ä¼°ä½ç½®çš„ç³»ç»Ÿã€‚

#### æ ¸å¿ƒç»„ä»¶

1. **æŸ¥è¯¢ç”Ÿæˆå™¨ï¼ˆGeneratorsï¼‰**
   - **åœ†å½¢ç”Ÿæˆå™¨**ï¼šåœ¨æŒ‡å®šä¸­å¿ƒç‚¹å‘¨å›´ç”Ÿæˆå€™é€‰ä½ç½®
   - **ç½‘æ ¼ç”Ÿæˆå™¨**ï¼šåœ¨æŒ‡å®šåŒºåŸŸç”Ÿæˆç½‘æ ¼ç‚¹
   - **è·¯å¾„ç”Ÿæˆå™¨**ï¼šæ²¿ç€è·¯å¾„ç”Ÿæˆå€™é€‰ç‚¹

2. **æµ‹è¯•å™¨ï¼ˆTestsï¼‰**
   - **è·ç¦»æµ‹è¯•**ï¼šè¯„ä¼°åˆ°ç›®æ ‡çš„è·ç¦»
   - **å¯è§æ€§æµ‹è¯•**ï¼šæ£€æŸ¥æ˜¯å¦æœ‰è§†çº¿
   - **å±é™©åº¦æµ‹è¯•**ï¼šè¯„ä¼°ä½ç½®çš„å®‰å…¨æ€§
   - **å¯†åº¦æµ‹è¯•**ï¼šæ£€æŸ¥å‘¨å›´å®ä½“å¯†åº¦

3. **ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰**
   - æŸ¥è¯¢å‘èµ·è€…çš„ä½ç½®å’Œæœå‘
   - ç¯å¢ƒä¸­çš„å…¶ä»–å®ä½“ä¿¡æ¯
   - åœ°å½¢å’Œå¯¼èˆªæ•°æ®

#### EQS æŸ¥è¯¢æµç¨‹

```
1. ç”Ÿæˆå€™é€‰ä½ç½® â†’ 2. åº”ç”¨æµ‹è¯•å™¨è¯„ä¼° â†’ 3. è®¡ç®—ç»¼åˆè¯„åˆ† â†’ 4. è¿”å›æ’åºç»“æœ
```

### EQS ä¸è¡Œä¸ºæ ‘çš„é›†æˆ

```typescript
class EQSQueryNode extends Action {
  private query: EQSQuery;

  tick(tick: Tick): number {
    const context = this.buildQueryContext(tick);
    const results = this.executeEQSQuery(this.query, context);

    if (results.length > 0) {
      // å°†æœ€ä½³ä½ç½®å­˜å‚¨åˆ°é»‘æ¿
      tick.blackboard.set('best_position', results[0].position);
      tick.blackboard.set('position_score', results[0].score);
      return SUCCESS;
    }

    return FAILURE;
  }
}
```

---

## ğŸ¤ ä¸¤ä¸ªç³»ç»Ÿçš„å…³ç³»ä¸ååŒ

### ç³»ç»Ÿå…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è¡Œä¸ºæ ‘å†³ç­–    â”‚â”€â”€â”€â”€â”‚ ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨  â”‚â”€â”€â”€â”€â”‚   ç¯å¢ƒæŸ¥è¯¢EQS   â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ æˆ˜æœ¯å†³ç­–      â”‚    â”‚ â€¢ å®æ—¶çŠ¶æ€æ„ŸçŸ¥  â”‚    â”‚ â€¢ ä½ç½®è¯„ä¼°      â”‚
â”‚ â€¢ æ¡ä»¶åˆ¤æ–­      â”‚    â”‚ â€¢ æŒ‰éœ€è®¡ç®—      â”‚    â”‚ â€¢ è·¯å¾„è§„åˆ’      â”‚
â”‚ â€¢ åŠ¨ä½œæ‰§è¡Œ      â”‚    â”‚ â€¢ æ™ºèƒ½ç¼“å­˜      â”‚    â”‚ â€¢ æˆ˜ç•¥åˆ†æ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ååŒå·¥ä½œæµç¨‹         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ååŒå·¥ä½œæµç¨‹

#### åœºæ™¯1ï¼šAIé è¿‘ä¸»äºº

**ä¼ ç»Ÿæµç¨‹**ï¼š
```
è¡Œä¸ºæ ‘ â†’ ç¡¬ç¼–ç ä½ç½®è®¡ç®— â†’ ç›´æ¥ç§»åŠ¨
```

**ååŒæµç¨‹**ï¼š
```
1. è¡Œä¸ºæ ‘ï¼šæˆ‘æƒ³"é è¿‘ä¸»äºº"
2. ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨ï¼šè®¡ç®—ä¸»äººè·ç¦»å’Œæ–¹å‘
3. ç¯å¢ƒæŸ¥è¯¢EQSï¼šè¯„ä¼°æœ€ä½³é è¿‘è·¯å¾„å’Œä½ç½®
4. è¡Œä¸ºæ ‘ï¼šåŸºäºè¯„ä¼°ç»“æœæ‰§è¡Œç§»åŠ¨
```

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// è¡Œä¸ºæ ‘èŠ‚ç‚¹
new Sequence({
  children: [
    // 1. æŒ‰éœ€æ„ŸçŸ¥ä¸»äººä½ç½®
    new LazySensorGuard({
      sensorRequest: {
        type: 'owner_proximity',
        priority: 'medium',
        context: { range: 15.0 }
      },
      condition: (data) => data.value > 0.3, // ä¸»äººä¸è¿œä¸è¿‘
      child: new EQSQueryNode({
        query: {
          generators: [{ type: 'circle', center: 'owner', radius: 2.0 }],
          tests: [
            { type: 'distance', weight: 0.6, ideal: 1.5 },
            { type: 'visibility', weight: 0.4 }
          ]
        }
      })
    }),
    // 2. ç§»åŠ¨åˆ°æœ€ä½³ä½ç½®
    new MoveToTargetAction()
  ]
})
```

#### åœºæ™¯2ï¼šAIé¿å¼€éšœç¢ç‰©

**ååŒæµç¨‹**ï¼š
```
1. è¡Œä¸ºæ ‘ï¼šæ£€æµ‹åˆ°å‰è¿›è·¯å¾„è¢«é˜»æŒ¡
2. ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨ï¼šæ‰«æå‘¨å›´éšœç¢ç‰©
3. ç¯å¢ƒæŸ¥è¯¢EQSï¼šå¯»æ‰¾æœ€ä½³ç»•è¡Œè·¯å¾„
4. è¡Œä¸ºæ ‘ï¼šæ‰§è¡Œç»•è¡Œç­–ç•¥
```

### ç³»ç»Ÿè¾¹ç•Œä¸èŒè´£åˆ’åˆ†

#### ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨çš„èŒè´£
- âœ… å®æ—¶çŠ¶æ€æ„ŸçŸ¥
- âœ… æŒ‰éœ€æ•°æ®è®¡ç®—
- âœ… æ™ºèƒ½ç¼“å­˜ç®¡ç†
- âœ… æ€§èƒ½ä¼˜åŒ–

#### EQSçš„èŒè´£
- âœ… å¤æ‚ä½ç½®è¯„ä¼°
- âœ… å¤šæ¡ä»¶ç»¼åˆè¯„åˆ†
- âœ… æˆ˜ç•¥å†³ç­–æ”¯æŒ
- âœ… è·¯å¾„è§„åˆ’

#### è¡Œä¸ºæ ‘çš„èŒè´£
- âœ… æˆ˜æœ¯å†³ç­–é€»è¾‘
- âœ… ä¼ æ„Ÿå™¨æ•°æ®æ¶ˆè´¹
- âœ… EQSæŸ¥è¯¢è§¦å‘
- âœ… åŠ¨ä½œæ‰§è¡Œæ§åˆ¶

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### ä¼ ç»Ÿæ–¹å¼ vs ååŒæ–¹å¼

| æŒ‡æ ‡ | ä¼ ç»Ÿæ–¹å¼ | ååŒæ–¹å¼ | æ”¹è¿› |
|------|----------|----------|------|
| CPUå ç”¨ | æŒç»­80% | æŒ‰éœ€5-20% | 75%å‡å°‘ |
| å“åº”å»¶è¿Ÿ | å›ºå®š50ms | æ™ºèƒ½10-100ms | æ›´çµæ´» |
| å†³ç­–è´¨é‡ | å›ºå®šé€»è¾‘ | åŸºäºå®æ—¶è¯„ä¼° | å¤§å¹…æå‡ |
| æ‰©å±•æ€§ | ç¡¬ç¼–ç  | æ¨¡å—åŒ–é…ç½® | æé«˜ |

### ä¼ æ„Ÿå™¨ç¼“å­˜æ•ˆæœ

```
ç©ºé—²çŠ¶æ€ï¼š0è®¡ç®— â†’ 0ç½‘ç»œ â†’ 0å»¶è¿Ÿ
å¯¼èˆªçŠ¶æ€ï¼š5è®¡ç®—/ç§’ â†’ 50KB/ç§’ â†’ 20mså»¶è¿Ÿ
ç¤¾äº¤çŠ¶æ€ï¼š2è®¡ç®—/ç§’ â†’ 20KB/ç§’ â†’ 50mså»¶è¿Ÿ
```

---

## ğŸ› ï¸ å®ç°è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨åŸºç¡€ï¼ˆ4å‘¨ï¼‰
1. **ä¼ æ„Ÿå™¨æ¥å£è®¾è®¡**ï¼ˆ1å‘¨ï¼‰
2. **ç¼“å­˜æœºåˆ¶å®ç°**ï¼ˆ1å‘¨ï¼‰
3. **ä¼˜å…ˆçº§è°ƒåº¦**ï¼ˆ1å‘¨ï¼‰
4. **åŸºç¡€ä¼ æ„Ÿå™¨å®ç°**ï¼ˆ1å‘¨ï¼‰

### é˜¶æ®µ2ï¼šEQSé›†æˆä¼˜åŒ–ï¼ˆ4å‘¨ï¼‰
1. **æŸ¥è¯¢ç»“æœç¼“å­˜**ï¼ˆ1å‘¨ï¼‰
2. **å¼‚æ­¥æŸ¥è¯¢æ”¯æŒ**ï¼ˆ1å‘¨ï¼‰
3. **ä¸Šä¸‹æ–‡æ‰©å±•**ï¼ˆ1å‘¨ï¼‰
4. **æ€§èƒ½ç›‘æ§**ï¼ˆ1å‘¨ï¼‰

### é˜¶æ®µ3ï¼šååŒæœºåˆ¶å®Œå–„ï¼ˆ4å‘¨ï¼‰
1. **LazySensorGuardå®ç°**ï¼ˆ1å‘¨ï¼‰
2. **è¡Œä¸ºæ ‘é›†æˆ**ï¼ˆ1å‘¨ï¼‰
3. **é”™è¯¯å¤„ç†**ï¼ˆ1å‘¨ï¼‰
4. **æµ‹è¯•éªŒè¯**ï¼ˆ1å‘¨ï¼‰

---

## ğŸ¯ æ€»ç»“

### ç¯å¢ƒæ„ŸçŸ¥ä¼ æ„Ÿå™¨ = æ™ºèƒ½çš„æ„Ÿå®˜ç³»ç»Ÿ
- **æŒ‰éœ€å·¥ä½œ**ï¼šåªæœ‰éœ€è¦æ—¶æ‰è®¡ç®—ï¼Œé¿å…æµªè´¹
- **æ™ºèƒ½ç¼“å­˜**ï¼šè®°ä½ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå¤§å¹…é™ä½CPUå’Œç½‘ç»œå¼€é”€

### EQS = æˆ˜ç•¥å†³ç­–å¼•æ“
- **å¤æ‚è¯„ä¼°**ï¼šç»¼åˆå¤šæ¡ä»¶è¯„ä¼°ä½ç½®
- **æ™ºèƒ½æ’åº**ï¼šæä¾›æœ€ä½³é€‰æ‹©å»ºè®®
- **æˆ˜æœ¯æ”¯æŒ**ï¼šè¾…åŠ©AIåšå‡ºæ›´å¥½å†³ç­–

### LLMå†³ç­–é›†æˆï¼šæœªæ¥æ¼”è¿›æ–¹å‘

#### ğŸ”® LLMä¼ æ„Ÿå™¨å†³ç­–èŠ‚ç‚¹

éšç€AIèƒ½åŠ›çš„æå‡ï¼Œå¯ä»¥å°†ä¼ æ„Ÿå™¨å†³ç­–æƒäº¤ç»™LLMï¼Œä½†è¦ä¿æŒé©¬å°”å¯å¤«æ€§ï¼š

```typescript
class LLMSensorDecisionNode extends Action {
  private llm: LLMService;
  private sensorManager: OnDemandSensorSystem;

  async tick(tick: Tick): Promise<number> {
    // æ„å»ºå½“å‰çŠ¶æ€ä¸Šä¸‹æ–‡ï¼ˆç¡®ä¿é©¬å°”å¯å¤«æ€§ï¼‰
    const context = {
      current_behavior: tick.blackboard.get('current_behavior'),
      active_actions: tick.blackboard.get('active_actions'),
      recent_observations: this.getRecentObservations(tick), // åªåŒ…å«æœ€è¿‘è§‚å¯Ÿ
      available_sensors: this.sensorManager.getAvailableSensors(),
      timestamp: Date.now()
    };

    // LLMæ¨ç†ï¼šå†³å®šéœ€è¦å“ªäº›ä¼ æ„Ÿå™¨
    const sensorDecision = await this.llm.decideSensorNeeds(context);

    // æŒ‰éœ€è¯·æ±‚ä¼ æ„Ÿå™¨æ•°æ®
    for (const sensor of sensorDecision.requiredSensors) {
      this.sensorManager.requestSensor(sensor, {
        priority: sensorDecision.priorities[sensor] || 'medium',
        context: sensorDecision.contexts[sensor]
      });
    }

    // ç­‰å¾…ä¼ æ„Ÿå™¨æ•°æ®åˆ°è¾¾
    if (!this.allSensorsReady(sensorDecision.requiredSensors)) {
      return RUNNING;
    }

    // LLMå†³ç­–ï¼šåŸºäºä¼ æ„Ÿå™¨æ•°æ®å†³å®šä¸‹ä¸€æ­¥è¡Œä¸º
    const behaviorDecision = await this.llm.decideNextAction({
      ...context,
      sensor_data: this.getSensorData(sensorDecision.requiredSensors)
    });

    return this.executeBehaviorDecision(behaviorDecision, tick);
  }

  private getRecentObservations(tick: Tick): Observation[] {
    // åªè¿”å›æœ€è¿‘çš„è§‚å¯Ÿç»“æœï¼Œä¸åŒ…å«å†å²æ¨ç†è¿‡ç¨‹
    const observations = tick.blackboard.get('recent_observations') || [];
    return observations.slice(-5); // æœ€è¿‘5ä¸ªè§‚å¯Ÿ
  }
}
```

#### ğŸ›¡ï¸ é©¬å°”å¯å¤«æ€§ä¿éšœæœºåˆ¶

```typescript
class MarkovLLMGuard {
  // ç¡®ä¿LLMå†³ç­–åŸºäºå½“å‰çŠ¶æ€è€Œéå†å²
  private stateIsolation: StateIsolationManager;

  async makeDecision(context: CurrentStateContext): Promise<LLMDecision> {
    // éš”ç¦»æ¨ç†çŠ¶æ€ï¼Œä¸æ±¡æŸ“å…¨å±€é»‘æ¿
    const isolatedContext = this.stateIsolation.createIsolatedContext(context);

    const decision = await this.llm.decide(isolatedContext);

    // åªè¿”å›å†³ç­–ç»“æœï¼Œä¸ä¿ç•™æ¨ç†ä¸­é—´çŠ¶æ€
    return {
      action: decision.action,
      reasoning: decision.final_reasoning, // åªä¿ç•™æœ€ç»ˆæ¨ç†
      confidence: decision.confidence
    };
  }
}
```

### ååŒä¼˜åŠ¿
- **æ€§èƒ½ä¸æ™ºèƒ½çš„å®Œç¾å¹³è¡¡**
- **æ¨¡å—åŒ–æ¶æ„ï¼Œæ˜“äºæ‰©å±•**
- **å®æ—¶é€‚åº”æ€§ï¼Œå†³ç­–æ›´å‡†ç¡®**
- **èµ„æºæ•ˆç‡ï¼Œå“åº”æ›´è¿…é€Ÿ**

### ğŸ­ ä¸‰ç§å†³ç­–æ¨¡å¼çš„æ¼”è¿›è·¯å¾„

| é˜¶æ®µ | å†³ç­–æ–¹å¼ | ç‰¹ç‚¹ | é©¬å°”å¯å¤«æ€§ |
|------|----------|------|-----------|
| **å½“å‰** | è§„åˆ™ç³»ç»Ÿ | é«˜æ•ˆã€ç¡®å®šæ€§ã€å¯é¢„æµ‹ | âœ… å®Œç¾ |
| **è¿‡æ¸¡** | æ··åˆæ¨¡å¼ | ç®€å•åœºæ™¯ç”¨è§„åˆ™ï¼Œå¤æ‚åœºæ™¯ç”¨LLM | âœ… ä¿æŒ |
| **æœªæ¥** | LLMä¸»å¯¼ | å®Œå…¨è‡ªé€‚åº”ã€å­¦ä¹ èƒ½åŠ›å¼º | âš ï¸ éœ€è¦éš”ç¦»æœºåˆ¶ |

é€šè¿‡è¿™ä¸¤ä¸ªç³»ç»Ÿçš„ååŒï¼ŒAIä¸ä»…èƒ½å®æ—¶æ„ŸçŸ¥ç¯å¢ƒï¼Œè¿˜èƒ½åšå‡ºåŸºäºå¤æ‚è¯„ä¼°çš„æ™ºèƒ½å†³ç­–ï¼

**æœªæ¥å±•æœ›**ï¼šéšç€LLMèƒ½åŠ›çš„æå‡ï¼Œæˆ‘ä»¬å¯ä»¥é€æ­¥è¿‡æ¸¡åˆ°LLMå†³ç­–ï¼Œä½†å¿…é¡»é€šè¿‡çŠ¶æ€éš”ç¦»å’Œå§”æ‰˜æœºåˆ¶ä¿æŒé©¬å°”å¯å¤«æ€§çš„æ ¸å¿ƒåŸåˆ™ã€‚